<!$Id: atmel-header.html 15414 2009-05-08 14:48:39Z sschneid $>
<html>
 <head>
  <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
  <title>AVR2025: IEEE 802.15.4 MAC Reference Manual</title>
  <link href="doxygen.css" rel="stylesheet" type="text/css">
</head>
<body>

<table width="100%" height="10%" bgcolor="#FFFFFF">
  <tr>
    <td colspan="2"><p><A href=http://www.atmel.com ><img src="..//graphics//atmel.jpg"/ border=0></A></p><br /></td>
    <td colspan="2"> <strong><font face="Helvetica" color="#000000" size="+3">Microcontroller Wireless Solutions</font></strong></td>
    <td colspan="2"><p><A href=http://www.atmel.com/products/AVR><img src="..//graphics//AVR_logo_blue.gif"/ border=0></A></p><br /></td>
  </tr>
  <tr>
    <td colspan="6" height="1" background="..//graphics//blue.gif"></td>
  </tr>
</table>
<!-- Generated by Doxygen 1.5.6 -->
<div class="contents">
<h1><a class="anchor" name="pFwImplementation">Firmware Implementation </a></h1>After executing <a class="el" href="group__apiPalAppDemo.html#gdd3190cf715f513666f4be42874d91e2" title="Application initialisation function.">app_init()</a>, the function <a class="el" href="group__apiPalAppDemo.html#gf59e38af599b4376e50df1a516c42587" title="Application task function.">app_task()</a> is called in an infinite loop. Inside <a class="el" href="group__apiPalAppDemo.html#gf59e38af599b4376e50df1a516c42587" title="Application task function.">app_task()</a> it is checked if a button event had happened (see <a class="el" href="group__apiPalAppDemo.html#g900627c84a59d50276496b0f5554abc8" title="Button debounce routine.">app_debounce_button()</a>).<p>
If a button event occurs, a frame is transmitted. Therefore the transceiver is set to state PLL_ON, and the frame transmission is initiated. If the frame transmission is completed, the TX_END interrupt occurs and the function <a class="el" href="group__apiPalAppDemo.html#g3385900f94992e560747cdc3d54950cb" title="TX_END IRQ handler.">irq_tx_end_handler()</a> is executed. In this function the transceiver is switched back to state RX_ON.<p>
In state RX_ON, frames can be received. An incoming frame is signalled by the RX_END interrupt. In the handler routine for this interrupt (<a class="el" href="group__apiPalAppDemo.html#g93873354ad6fd915028d366a37128740" title="RX_END IRQ handler.">irq_rx_end_handler()</a>), the CRC of the received frame is checked. The frame is uploaded and the address field is compared with the default values, if the CRC was correct. If the address check succeeds, the RX counter <a class="el" href="main_8c.html#c4d763b359e41d4f238eb40d68b46ed1">rx_cnt</a> is incremented. At the end of <a class="el" href="group__apiPalAppDemo.html#g93873354ad6fd915028d366a37128740" title="RX_END IRQ handler.">irq_rx_end_handler()</a>, the actual value of <a class="el" href="main_8c.html#c4d763b359e41d4f238eb40d68b46ed1">rx_cnt</a> is displayed on the LEDs.<p>
The source code of the PAL Example Application - Simple LED Remote Control application is listed here:<p>
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00011"></a>00011 <span class="comment">/*</span>
<a name="l00012"></a>00012 <span class="comment"> * Copyright (c) 2009, Atmel Corporation All rights reserved.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * Licensed under Atmel's Limited License Agreement --&gt; EULA.txt</span>
<a name="l00015"></a>00015 <span class="comment"> */</span>
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="comment">/* === INCLUDES ============================================================ */</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;stddef.h&gt;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &lt;stdint.h&gt;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;stdbool.h&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include "<a class="code" href="pal_8h.html" title="PAL related APIs.">pal.h</a>"</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include "stack_config.h"</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include "<a class="code" href="app__config_8h.html" title="These are application-specific resources which are used in the application in addition...">app_config.h</a>"</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include "<a class="code" href="simple__remote__led__control_8h.html" title="Application header file for PAL Demo Application &amp;quot;Simple Remote LED Control&amp;quot;...">simple_remote_led_control.h</a>"</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="comment">/* === TYPES =============================================================== */</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="comment">/* === MACROS ============================================================== */</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="comment">/* === GLOBALS ============================================================= */</span>
<a name="l00033"></a>00033 
<a name="l00035"></a>00035 <span class="keyword">static</span> uint8_t <a class="code" href="main_8c.html#401dd022349f23172a53f7487b528b13">tx_cnt</a> = 0;
<a name="l00037"></a>00037 <span class="keyword">static</span> uint8_t <a class="code" href="main_8c.html#c4d763b359e41d4f238eb40d68b46ed1">rx_cnt</a> = 0;
<a name="l00041"></a>00041 <span class="keyword">static</span> <span class="keyword">volatile</span> uint8_t <a class="code" href="main_8c.html#fa4cafe0f0f3575f947bbc93933b2a2c">tx_flag</a> = 0;
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="comment">/* === PROTOTYPES ========================================================== */</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="comment">/* === IMPLEMENTATION ====================================================== */</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 
<a name="l00054"></a>00054 <span class="keywordtype">int</span> <a class="code" href="group__apiPalAppDemo.html#g840291bc02cba5474a4cb46a9b9566fe" title="Main function of the PAL Demo Application &amp;quot;Simple Remote LED Control&amp;quot;.">main</a>(<span class="keywordtype">void</span>)
<a name="l00055"></a>00055 {
<a name="l00056"></a>00056     <a class="code" href="group__apiPalAppDemo.html#gdd3190cf715f513666f4be42874d91e2" title="Application initialisation function.">app_init</a>();
<a name="l00057"></a>00057 
<a name="l00058"></a>00058     <a class="code" href="group__apiPalAppDemo.html#g6024bf5027e46ebcfc1f70d45877df18" title="Display of a decimal value on the available LEDs.">app_set_led_value</a>(0);
<a name="l00059"></a>00059     <span class="keywordflow">while</span>(1)
<a name="l00060"></a>00060     {
<a name="l00061"></a>00061         <a class="code" href="group__apiPalAppDemo.html#gf59e38af599b4376e50df1a516c42587" title="Application task function.">app_task</a>();
<a name="l00062"></a>00062         <span class="comment">/*</span>
<a name="l00063"></a>00063 <span class="comment">         * Calling the PAL task is currently not required for this application,</span>
<a name="l00064"></a>00064 <span class="comment">         * since no timer are used and USB is not enabled.</span>
<a name="l00065"></a>00065 <span class="comment">         * The call to pal_task() is inserted anyway. This allows easy extension</span>
<a name="l00066"></a>00066 <span class="comment">         * of this application, for example to use application timers properly.</span>
<a name="l00067"></a>00067 <span class="comment">         */</span>
<a name="l00068"></a>00068         <a class="code" href="pal_8h.html#057e433e0200eb99b5f67c5336dbc323" title="Services timer and sio handler.">pal_task</a>();
<a name="l00069"></a>00069     }
<a name="l00070"></a>00070 }
<a name="l00071"></a>00071 
<a name="l00084"></a>00084 <span class="keywordtype">void</span> <a class="code" href="group__apiPalAppDemo.html#gdd3190cf715f513666f4be42874d91e2" title="Application initialisation function.">app_init</a>(<span class="keywordtype">void</span>)
<a name="l00085"></a>00085 {
<a name="l00086"></a>00086     uint8_t trx_state;
<a name="l00087"></a>00087 
<a name="l00088"></a>00088     <span class="comment">/* Step 0: init MCU peripherals */</span>
<a name="l00089"></a>00089     <a class="code" href="group__apiPalApi.html#g7ba90b2aacd564c33138bf6902bd8bca" title="Initialization of PAL.">pal_init</a>();
<a name="l00090"></a>00090     <a class="code" href="pal_8h.html#5db1c656abbcbee8ce636786618837ef" title="LED initialization.">pal_led_init</a>();
<a name="l00091"></a>00091     <a class="code" href="pal_8h.html#0e9a00bb4939cba309acd84674481230" title="Button initialization.">pal_button_init</a>();
<a name="l00092"></a>00092 <span class="preprocessor">#if (TAL_TYPE == ATMEGARF_TAL_1)</span>
<a name="l00093"></a>00093 <span class="preprocessor"></span>    pal_trx_irq_init_tx_end((FUNC_PTR)<a class="code" href="group__apiPalAppDemo.html#g3385900f94992e560747cdc3d54950cb" title="TX_END IRQ handler.">irq_tx_end_handler</a>);
<a name="l00094"></a>00094     pal_trx_irq_init_rx_end((FUNC_PTR)<a class="code" href="group__apiPalAppDemo.html#g93873354ad6fd915028d366a37128740" title="RX_END IRQ handler.">irq_rx_end_handler</a>);
<a name="l00095"></a>00095 <span class="preprocessor">#elif (TAL_TYPE == AT86RF230B)</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span>    <a class="code" href="group__apiPalApi.html#g0a8267117928a29ab0dbf94013c35a80" title="Initializes the transceiver main interrupt.">pal_trx_irq_init</a>((FUNC_PTR)<a class="code" href="group__apiPalAppDemo.html#g2421f6837739baa67a306fe9543715aa" title="Main IRQ handler.">irq_trx_end_handler</a>);
<a name="l00097"></a>00097 <span class="preprocessor">#endif</span>
<a name="l00098"></a>00098 <span class="preprocessor"></span>
<a name="l00099"></a>00099     <a class="code" href="group__apiPalAppDemo.html#g6024bf5027e46ebcfc1f70d45877df18" title="Display of a decimal value on the available LEDs.">app_set_led_value</a>(0);
<a name="l00100"></a>00100 
<a name="l00101"></a>00101     <span class="comment">/* Step 1: reset transceiver */</span>
<a name="l00102"></a>00102     <a class="code" href="group__apiPalApi.html#g1befdc5edc9e6a9f76895140552c7cba" title="Generates blocking delay.">pal_timer_delay</a>(880);
<a name="l00103"></a>00103     <a class="code" href="pal_8h.html#69366461b21ba05299802358bc8388c0">PAL_RST_LOW</a>();
<a name="l00104"></a>00104     <a class="code" href="pal_8h.html#1441d594c76410852907f9b917141a24">PAL_SLP_TR_LOW</a>();
<a name="l00105"></a>00105     <a class="code" href="group__apiPalApi.html#g1befdc5edc9e6a9f76895140552c7cba" title="Generates blocking delay.">pal_timer_delay</a>(10);
<a name="l00106"></a>00106     <a class="code" href="pal_8h.html#14f2569844671800395115b02424adb5">PAL_RST_HIGH</a>();
<a name="l00107"></a>00107     <a class="code" href="group__apiPalAppDemo.html#g6024bf5027e46ebcfc1f70d45877df18" title="Display of a decimal value on the available LEDs.">app_set_led_value</a>(1);
<a name="l00108"></a>00108 
<a name="l00109"></a>00109     <span class="comment">/* Step 2: set trx to TRX_OFF and verify it. */</span>
<a name="l00110"></a>00110     <a class="code" href="group__apiPalApi.html#ga3bf62e2394e1a9b52fcd492c28f50dc" title="Writes data into a transceiver register.">pal_trx_reg_write</a>(RG_TRX_STATE, CMD_TRX_OFF);
<a name="l00111"></a>00111     <a class="code" href="group__apiPalApi.html#g1befdc5edc9e6a9f76895140552c7cba" title="Generates blocking delay.">pal_timer_delay</a>(510);
<a name="l00112"></a>00112 
<a name="l00113"></a>00113     <span class="keywordflow">do</span>
<a name="l00114"></a>00114     {
<a name="l00115"></a>00115         trx_state = <a class="code" href="group__apiPalApi.html#gb06627709265af4e38e0eba63c6b59a9" title="Subregister read.">pal_trx_bit_read</a>(SR_TRX_STATUS);
<a name="l00116"></a>00116     } <span class="keywordflow">while</span> (trx_state != TRX_OFF);
<a name="l00117"></a>00117 
<a name="l00118"></a>00118     <a class="code" href="group__apiPalAppDemo.html#g6024bf5027e46ebcfc1f70d45877df18" title="Display of a decimal value on the available LEDs.">app_set_led_value</a>(2);
<a name="l00119"></a>00119 
<a name="l00120"></a>00120     <span class="comment">/* Step 3: set channel and enbale IRQ handling and crc. */</span>
<a name="l00121"></a>00121     <a class="code" href="group__apiPalApi.html#gbed0355d678d59c149f001310969044a" title="Subregister write.">pal_trx_bit_write</a>(SR_CHANNEL, <a class="code" href="simple__remote__led__control_8h.html#afa17c307af8c45323500fdac999d294">DEFAULT_CHANNEL</a>);
<a name="l00122"></a>00122     <a class="code" href="group__apiPalApi.html#g3b0bf90d2d517ddc581401bef389591d" title="Reads current value from a transceiver register.">pal_trx_reg_read</a>(RG_IRQ_STATUS);
<a name="l00123"></a>00123 <span class="preprocessor">#if (TAL_TYPE == ATMEGARF_TAL_1)</span>
<a name="l00124"></a>00124 <span class="preprocessor"></span>    <a class="code" href="group__apiPalApi.html#ga3bf62e2394e1a9b52fcd492c28f50dc" title="Writes data into a transceiver register.">pal_trx_reg_write</a>(RG_IRQ_MASK, _BV(TX_END_EN) | _BV(RX_END_EN));
<a name="l00125"></a>00125 <span class="preprocessor">#elif (TAL_TYPE == AT86RF230B)</span>
<a name="l00126"></a>00126 <span class="preprocessor"></span>    <a class="code" href="group__apiPalApi.html#gbed0355d678d59c149f001310969044a" title="Subregister write.">pal_trx_bit_write</a>(SR_TX_AUTO_CRC_ON, 1);
<a name="l00127"></a>00127     <a class="code" href="group__apiPalApi.html#ga3bf62e2394e1a9b52fcd492c28f50dc" title="Writes data into a transceiver register.">pal_trx_reg_write</a>(RG_IRQ_MASK, TRX_IRQ_TRX_END);
<a name="l00128"></a>00128     <a class="code" href="group__apiPalApi.html#gea24097c88cc17a48592724f84c29c4c" title="Enables the transceiver main interrupt.">pal_trx_irq_en</a>();
<a name="l00129"></a>00129 <span class="preprocessor">#endif</span>
<a name="l00130"></a>00130 <span class="preprocessor"></span>    <a class="code" href="group__apiPalAppDemo.html#g6024bf5027e46ebcfc1f70d45877df18" title="Display of a decimal value on the available LEDs.">app_set_led_value</a>(3);
<a name="l00131"></a>00131 
<a name="l00132"></a>00132     <span class="comment">/* Step 4: ready to receive data. */</span>
<a name="l00133"></a>00133     <a class="code" href="group__apiPalAppDemo.html#g82befd9f01900c5d2a74a8d1f3667f0f" title="Set transceiver state function.">trx_set_state</a>(RX_ON);
<a name="l00134"></a>00134     <a class="code" href="group__apiPalApi.html#g67da762b98e25737b5322909235cf7b1" title="Enables the global interrupt.">pal_global_irq_enable</a>();
<a name="l00135"></a>00135     <a class="code" href="group__apiPalAppDemo.html#g6024bf5027e46ebcfc1f70d45877df18" title="Display of a decimal value on the available LEDs.">app_set_led_value</a>(4);
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 }
<a name="l00138"></a>00138 
<a name="l00154"></a>00154 <span class="keywordtype">void</span> <a class="code" href="group__apiPalAppDemo.html#gf59e38af599b4376e50df1a516c42587" title="Application task function.">app_task</a>(<span class="keywordtype">void</span>)
<a name="l00155"></a>00155 {
<a name="l00156"></a>00156     <a class="code" href="structapp__frame__t.html">app_frame_t</a> tx_frame;
<a name="l00157"></a>00157     <span class="keyword">static</span> uint8_t key_press = 0;
<a name="l00158"></a>00158 
<a name="l00159"></a>00159     key_press = <a class="code" href="group__apiPalAppDemo.html#g900627c84a59d50276496b0f5554abc8" title="Button debounce routine.">app_debounce_button</a>();
<a name="l00160"></a>00160 
<a name="l00161"></a>00161     <span class="keywordflow">if</span>((key_press != 0) &amp;&amp; (tx_flag == 0))
<a name="l00162"></a>00162     {
<a name="l00163"></a>00163         tx_flag = 1;
<a name="l00164"></a>00164         <a class="code" href="group__apiPalApi.html#g163faa5bccd87aa81763fb5adb3eeb31" title="LED handling.">pal_led</a>(LED_0, <a class="code" href="pal_8h.html#1256740334139058b73d97a8a4ad2b411b3bca014fbbfe339c8e216d175bae2e">LED_TOGGLE</a>);
<a name="l00165"></a>00165 
<a name="l00166"></a>00166         tx_frame.<a class="code" href="structapp__frame__t.html#ad8e95e7f0fdb4a74ba7ea38f3517b7c">phr</a> = <a class="code" href="simple__remote__led__control_8h.html#ce07c4132b300a4bd408a799a08c617c">APP_FRAME_SIZE</a>;
<a name="l00167"></a>00167         tx_frame.<a class="code" href="structapp__frame__t.html#15e913cdf34c3d39edd7dee1eb74a5dc">fcf</a> = <a class="code" href="simple__remote__led__control_8h.html#1243ee3fa1f98ecb1b8c4218b31a99c2">BLINK_FCF</a>;
<a name="l00168"></a>00168         tx_frame.<a class="code" href="structapp__frame__t.html#727158e808fd0948bd533d6f35412be2">span</a> = <a class="code" href="simple__remote__led__control_8h.html#c882eec132299fcede95e97de88f550a">BLINK_PANID</a>;
<a name="l00169"></a>00169         tx_frame.<a class="code" href="structapp__frame__t.html#be53af390c5351c85586b043d98687e5">saddr</a> = <a class="code" href="simple__remote__led__control_8h.html#6d148bd6dbcabbc4818e7f39d62220ed">BLINK_SRCAD</a>;
<a name="l00170"></a>00170         tx_frame.<a class="code" href="structapp__frame__t.html#c24e3e5c1b693295195e563d262ddc8f">seq</a> = tx_cnt;
<a name="l00171"></a>00171         strncpy(tx_frame.<a class="code" href="structapp__frame__t.html#37590bb13e2936e30b7f704b0ea6e6f3">data</a>, <a class="code" href="simple__remote__led__control_8h.html#83f69a8deb29e36caabc38a26d46a102">ID_STRING</a>, <span class="keyword">sizeof</span>(<a class="code" href="simple__remote__led__control_8h.html#83f69a8deb29e36caabc38a26d46a102">ID_STRING</a>));
<a name="l00172"></a>00172 
<a name="l00173"></a>00173         <a class="code" href="group__apiPalAppDemo.html#g82befd9f01900c5d2a74a8d1f3667f0f" title="Set transceiver state function.">trx_set_state</a>(PLL_ON);
<a name="l00174"></a>00174         <a class="code" href="group__apiPalApi.html#ga3bf62e2394e1a9b52fcd492c28f50dc" title="Writes data into a transceiver register.">pal_trx_reg_write</a>(RG_TRX_STATE, CMD_TX_START);
<a name="l00175"></a>00175         <a class="code" href="group__apiPalApi.html#g89baa48c35c21c98b853f56ad42b9da6" title="Writes data into frame buffer of the transceiver.">pal_trx_frame_write</a>((uint8_t*)&amp;tx_frame, <a class="code" href="simple__remote__led__control_8h.html#ce07c4132b300a4bd408a799a08c617c">APP_FRAME_SIZE</a>);
<a name="l00176"></a>00176         key_press = 0;
<a name="l00177"></a>00177 
<a name="l00178"></a>00178     }
<a name="l00179"></a>00179     <a class="code" href="group__apiPalApi.html#g1befdc5edc9e6a9f76895140552c7cba" title="Generates blocking delay.">pal_timer_delay</a>(<a class="code" href="simple__remote__led__control_8h.html#27702e067fb882553a6af7eb5974f600">DEBOUNCE_PERIOD</a>);
<a name="l00180"></a>00180 }
<a name="l00181"></a>00181 
<a name="l00197"></a>00197 <span class="keywordtype">void</span> <a class="code" href="group__apiPalAppDemo.html#g82befd9f01900c5d2a74a8d1f3667f0f" title="Set transceiver state function.">trx_set_state</a>(uint8_t state)
<a name="l00198"></a>00198 {
<a name="l00199"></a>00199     uint8_t cmd = 0, curr_state;
<a name="l00200"></a>00200 
<a name="l00201"></a>00201     <span class="keywordflow">switch</span>(state)
<a name="l00202"></a>00202     {
<a name="l00203"></a>00203         <span class="keywordflow">case</span> TRX_OFF:
<a name="l00204"></a>00204             cmd = CMD_TRX_OFF;
<a name="l00205"></a>00205             <span class="keywordflow">break</span>;
<a name="l00206"></a>00206 
<a name="l00207"></a>00207         <span class="keywordflow">case</span> PLL_ON:
<a name="l00208"></a>00208             cmd = CMD_PLL_ON;
<a name="l00209"></a>00209             <span class="keywordflow">break</span>;
<a name="l00210"></a>00210 
<a name="l00211"></a>00211         <span class="keywordflow">case</span> RX_ON:
<a name="l00212"></a>00212             cmd = CMD_RX_ON;
<a name="l00213"></a>00213             <span class="keywordflow">break</span>;
<a name="l00214"></a>00214 
<a name="l00215"></a>00215         <span class="keywordflow">default</span>:
<a name="l00216"></a>00216             <a class="code" href="simple__remote__led__control_8h.html#28301f76c53b643912da7c538f74e2c6">ASSERT</a>(1==0);
<a name="l00217"></a>00217             <span class="keywordflow">break</span>;
<a name="l00218"></a>00218     }
<a name="l00219"></a>00219 
<a name="l00220"></a>00220     <a class="code" href="group__apiPalApi.html#gbed0355d678d59c149f001310969044a" title="Subregister write.">pal_trx_bit_write</a>(SR_TRX_CMD, CMD_FORCE_TRX_OFF);
<a name="l00221"></a>00221     <a class="code" href="group__apiPalApi.html#gbed0355d678d59c149f001310969044a" title="Subregister write.">pal_trx_bit_write</a>(SR_TRX_CMD, cmd);
<a name="l00222"></a>00222     <a class="code" href="group__apiPalApi.html#g1befdc5edc9e6a9f76895140552c7cba" title="Generates blocking delay.">pal_timer_delay</a>(48);
<a name="l00223"></a>00223 
<a name="l00224"></a>00224     <span class="keywordflow">do</span>
<a name="l00225"></a>00225     {
<a name="l00226"></a>00226         curr_state = <a class="code" href="group__apiPalApi.html#gb06627709265af4e38e0eba63c6b59a9" title="Subregister read.">pal_trx_bit_read</a>(SR_TRX_STATUS);
<a name="l00227"></a>00227     } <span class="keywordflow">while</span> (curr_state != state);
<a name="l00228"></a>00228 }
<a name="l00229"></a>00229 
<a name="l00230"></a>00230 
<a name="l00231"></a>00231 
<a name="l00241"></a>00241 uint8_t <a class="code" href="group__apiPalAppDemo.html#g2c51c5ab1a4f0c83534a2f0066a402a0" title="Frame read function.">trx_frame_read</a>(uint8_t *data)
<a name="l00242"></a>00242 {
<a name="l00243"></a>00243 uint8_t phr;
<a name="l00244"></a>00244 <span class="preprocessor">#if (TAL_TYPE == ATMEGARF_TAL_1)</span>
<a name="l00245"></a>00245 <span class="preprocessor"></span>    phr = *data = <a class="code" href="group__apiPalApi.html#g3b0bf90d2d517ddc581401bef389591d" title="Reads current value from a transceiver register.">pal_trx_reg_read</a>(RG_TST_RX_LENGTH);
<a name="l00246"></a>00246     <a class="code" href="group__apiPalApi.html#g567fce74d2ddb73921f679c1a907cd2f" title="Reads frame buffer of the transceiver.">pal_trx_frame_read</a>(data + 1,(phr&amp;0x7f));
<a name="l00247"></a>00247 <span class="preprocessor">#elif (TAL_TYPE == AT86RF230B)</span>
<a name="l00248"></a>00248 <span class="preprocessor"></span>    <a class="code" href="group__apiPalApi.html#g567fce74d2ddb73921f679c1a907cd2f" title="Reads frame buffer of the transceiver.">pal_trx_frame_read</a>(&amp;phr,1);
<a name="l00249"></a>00249     <a class="code" href="group__apiPalApi.html#g567fce74d2ddb73921f679c1a907cd2f" title="Reads frame buffer of the transceiver.">pal_trx_frame_read</a>(data,(phr&amp;0x7f));
<a name="l00250"></a>00250 <span class="preprocessor">#endif</span>
<a name="l00251"></a>00251 <span class="preprocessor"></span>    <span class="keywordflow">return</span> phr;
<a name="l00252"></a>00252 }
<a name="l00253"></a>00253 
<a name="l00254"></a>00254 <span class="preprocessor">#if (TAL_TYPE == AT86RF230B)</span>
<a name="l00255"></a>00255 <span class="preprocessor"></span>
<a name="l00265"></a>00265 <span class="keywordtype">void</span> <a class="code" href="group__apiPalAppDemo.html#g2421f6837739baa67a306fe9543715aa" title="Main IRQ handler.">irq_trx_end_handler</a>(<span class="keywordtype">void</span>)
<a name="l00266"></a>00266 {
<a name="l00267"></a>00267     <a class="code" href="group__apiPalApi.html#g3b0bf90d2d517ddc581401bef389591d" title="Reads current value from a transceiver register.">pal_trx_reg_read</a>(RG_IRQ_STATUS);
<a name="l00268"></a>00268     <span class="keywordflow">if</span> (tx_flag != 0)
<a name="l00269"></a>00269     {
<a name="l00270"></a>00270         <a class="code" href="group__apiPalAppDemo.html#g3385900f94992e560747cdc3d54950cb" title="TX_END IRQ handler.">irq_tx_end_handler</a>();
<a name="l00271"></a>00271     }
<a name="l00272"></a>00272     <span class="keywordflow">else</span>
<a name="l00273"></a>00273     {
<a name="l00274"></a>00274         <a class="code" href="group__apiPalAppDemo.html#g93873354ad6fd915028d366a37128740" title="RX_END IRQ handler.">irq_rx_end_handler</a>();
<a name="l00275"></a>00275     }
<a name="l00276"></a>00276 }
<a name="l00277"></a>00277 <span class="preprocessor">#endif</span>
<a name="l00278"></a>00278 <span class="preprocessor"></span>
<a name="l00292"></a>00292 <span class="keywordtype">void</span> <a class="code" href="group__apiPalAppDemo.html#g3385900f94992e560747cdc3d54950cb" title="TX_END IRQ handler.">irq_tx_end_handler</a>(<span class="keywordtype">void</span>)
<a name="l00293"></a>00293 {
<a name="l00294"></a>00294     <a class="code" href="group__apiPalApi.html#g163faa5bccd87aa81763fb5adb3eeb31" title="LED handling.">pal_led</a>(LED_0, <a class="code" href="pal_8h.html#1256740334139058b73d97a8a4ad2b411b3bca014fbbfe339c8e216d175bae2e">LED_TOGGLE</a>);
<a name="l00295"></a>00295     <a class="code" href="group__apiPalAppDemo.html#g82befd9f01900c5d2a74a8d1f3667f0f" title="Set transceiver state function.">trx_set_state</a>(RX_ON);
<a name="l00296"></a>00296     tx_cnt ++;
<a name="l00297"></a>00297     tx_flag = 0;
<a name="l00298"></a>00298 }
<a name="l00299"></a>00299 
<a name="l00312"></a>00312 <span class="keywordtype">void</span> <a class="code" href="group__apiPalAppDemo.html#g93873354ad6fd915028d366a37128740" title="RX_END IRQ handler.">irq_rx_end_handler</a>(<span class="keywordtype">void</span>)
<a name="l00313"></a>00313 {
<a name="l00314"></a>00314     uint8_t rxframe[129], crc;
<a name="l00315"></a>00315     <a class="code" href="structapp__frame__t.html">app_frame_t</a> *pfrm;
<a name="l00316"></a>00316 
<a name="l00317"></a>00317     <a class="code" href="group__apiPalApi.html#g163faa5bccd87aa81763fb5adb3eeb31" title="LED handling.">pal_led</a>(LED_0, <a class="code" href="pal_8h.html#1256740334139058b73d97a8a4ad2b411b3bca014fbbfe339c8e216d175bae2e">LED_TOGGLE</a>);
<a name="l00318"></a>00318     crc = <a class="code" href="group__apiPalApi.html#gb06627709265af4e38e0eba63c6b59a9" title="Subregister read.">pal_trx_bit_read</a>(SR_RX_CRC_VALID);
<a name="l00319"></a>00319     <span class="keywordflow">if</span> (CRC16_VALID == crc)
<a name="l00320"></a>00320     {
<a name="l00321"></a>00321         <a class="code" href="group__apiPalAppDemo.html#g2c51c5ab1a4f0c83534a2f0066a402a0" title="Frame read function.">trx_frame_read</a>(rxframe);
<a name="l00322"></a>00322         pfrm = (<a class="code" href="structapp__frame__t.html">app_frame_t</a> *) rxframe;
<a name="l00323"></a>00323         <span class="keywordflow">if</span> ((pfrm-&gt;<a class="code" href="structapp__frame__t.html#727158e808fd0948bd533d6f35412be2">span</a> == <a class="code" href="simple__remote__led__control_8h.html#c882eec132299fcede95e97de88f550a">BLINK_PANID</a>) &amp;&amp;
<a name="l00324"></a>00324             (pfrm-&gt;<a class="code" href="structapp__frame__t.html#be53af390c5351c85586b043d98687e5">saddr</a> == <a class="code" href="simple__remote__led__control_8h.html#6d148bd6dbcabbc4818e7f39d62220ed">BLINK_SRCAD</a>) )
<a name="l00325"></a>00325         {
<a name="l00326"></a>00326             rx_cnt ++;
<a name="l00327"></a>00327         }
<a name="l00328"></a>00328     }
<a name="l00329"></a>00329     <a class="code" href="group__apiPalAppDemo.html#g6024bf5027e46ebcfc1f70d45877df18" title="Display of a decimal value on the available LEDs.">app_set_led_value</a>(rx_cnt);
<a name="l00330"></a>00330 }
<a name="l00331"></a>00331 
<a name="l00332"></a>00332 <span class="comment">/* EOF */</span>
</pre></div> </div>
<!$Id: atmel-footer.html 15414 2009-05-08 14:48:39Z sschneid $>
<html>
 <head>
  <meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
  <title>@DOC_TITLE@</title>
  <link href="doxygen.css" rel="stylesheet" type="text/css">
</head>
<body>

<table width="100%" height="10%" bgcolor="#FFFFFF">
  <tr>
    <td colspan="6" height="1" background="..//img//blue.gif"></td>
  </tr>

  <tr>
    <td colspan="6">
    <address style="align: right;"><small>
Generated on Mon Aug 23 09:08:42 2010 for PAL Example Application Simple Remote LED Control by <a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border=0></a> 1.5.6</small></address>
    </td>
  </tr>

</table>
